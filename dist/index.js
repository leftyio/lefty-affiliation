!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Lefty=t():e.Lefty=t()}(self,(()=>(()=>{"use strict";var e,t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};function n(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}t.r(r),t.d(r,{conversion:()=>p,createOrder:()=>f,createProduct:()=>l,createProductItem:()=>d,pixel:()=>m});var i=!1,a="https://a.lefty.io";function u(e,t,r){var n=new XMLHttpRequest;n.open(e,a+t,!0),n.setRequestHeader("Content-type","application/json"),n.withCredentials=!0;var o=new Promise((function(e,t){n.onreadystatechange=function(){4===this.readyState&&(200===this.status?e(n.responseText):t(new Error(n.statusText)))}}));return r?n.send(JSON.stringify(r)):n.send(),o}function c(e){return e.map((function(e){return e.totalAmount})).reduce((function(e,t){return e+t}),0)}function f(e,t,r,n){return{externalOrderId:e,items:t,currencyCode:r,amount:n||c(t)}}function l(e,t){return{externalProductId:e,name:t}}function d(e,t,r,n){return{externalOrderItemId:e,product:t,totalAmount:r,quantity:n}}function s(e,t){t=t||{};var r="/check?ref="+(e=e||window.location.hostname);if(t.xhr)return u("POST",r);var n=a+r;return new Promise((function(e,t){var r=new Image;r.onload=e,r.onerror=t,r.src=n}))}function p(t,r){r=r||{},t.pixelId=t.pixelId||e,t.referringDomain=r.referer||window.location.hostname;var n="/track/conversion";return i?(console.log("Lefty - conversion",t),u("POST",n,t)):s(r.referer,{xhr:!0}).then((function(e){if(!0===(e=JSON.parse(e)).matchable)return u("POST",n,t)}),(function(e){return console.error("Lefty - check",e)}))}function y(t,r){r=r||{};var n=t.items||[],o=t.externalOrderId,i=t.amount,u=t.pixelId||e,c=t.currencyCode||r.currencyCode,f=r.referer||window.location.hostname,l=a+"/track?type=conversion";if(l+="&orderId="+o,l+="&ref="+f,i&&(l+="&amount="+i),c&&(l+="&currency="+c),u&&(l+="&pixelId="+u),0!==n.length){var d=n.map((function(e){return"pId="+e.product.externalProductId})).join("&"),s=n.map((function(e){return"pName="+encodeURIComponent(e.product.name)})).join("&"),p=n.map((function(e){return"itemQty="+e.quantity})).join("&"),y=n.map((function(e){return"itemAmount="+e.totalAmount})).join("&"),m=n.map((function(e){return"itemId="+e.externalOrderItemId})).join("&");l+="&"+d,l+="&"+s,l+="&"+p,l+="&"+y,m&&(l+="&"+m)}(new Image).src=l}function m(e,t){return i?(console.log("Lefty - pixel",e),y(e,t)):s(t.referer).then((function(){return y(e,t)}),(function(e){return console.error("Lefty - check",e)}))}function v(t,r){e=t,i=(r=r||{}).debug||!1;for(var o=window._lefty||[];o.length;){var a=o.shift();h.apply(void 0,n(a))}}function h(){var e=Array.prototype.slice.call(arguments);switch(e.shift()){case"pixel":return m.apply(void 0,n(e));case"conversion":return p.apply(void 0,n(e));case"init":return v.apply(void 0,n(e))}}return window.lefty=h,r})()));